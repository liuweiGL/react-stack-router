var Je=Object.defineProperty,Qe=Object.defineProperties;var Ze=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var J=(l,c,d)=>c in l?Je(l,c,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[c]=d,m=(l,c)=>{for(var d in c||(c={}))he.call(c,d)&&J(l,d,c[d]);if(G)for(var d of G(c))fe.call(c,d)&&J(l,d,c[d]);return l},_=(l,c)=>Qe(l,Ze(c));var pe=(l,c)=>{var d={};for(var y in l)he.call(l,y)&&c.indexOf(y)<0&&(d[y]=l[y]);if(l!=null&&G)for(var y of G(l))c.indexOf(y)<0&&fe.call(l,y)&&(d[y]=l[y]);return d};var E=(l,c,d)=>(J(l,typeof c!="symbol"?c+"":c,d),d);(function(l,c){typeof exports=="object"&&typeof module!="undefined"?c(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],c):(l=typeof globalThis!="undefined"?globalThis:l||self,c(l["react-mobile-router"]={},l.React))})(this,function(l,c){"use strict";function d(){return d=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},d.apply(this,arguments)}var y;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(y||(y={}));var U=function(t){return t},D="beforeunload",de="hashchange",Q="popstate";function ge(t){t===void 0&&(t={});var e=t,n=e.window,r=n===void 0?document.defaultView:n,s=r.history;function i(){var u=r.location,a=u.pathname,o=u.search,f=u.hash,p=s.state||{};return[p.idx,U({pathname:a,search:o,hash:f,state:p.usr||null,key:p.key||"default"})]}var h=null;function k(){if(h)R.call(h),h=null;else{var u=y.Pop,a=i(),o=a[0],f=a[1];if(R.length){if(o!=null){var p=g-o;p&&(h={action:u,location:f,retry:function(){M(p*-1)}},M(p))}}else C(u)}}r.addEventListener(Q,k);var v=y.Pop,w=i(),g=w[0],P=w[1],L=z(),R=z();g==null&&(g=0,s.replaceState(d({},s.state,{idx:g}),""));function F(u){return typeof u=="string"?u:K(u)}function j(u,a){return a===void 0&&(a=null),U(d({pathname:P.pathname,hash:"",search:""},typeof u=="string"?B(u):u,{state:a,key:Z()}))}function I(u,a){return[{usr:u.state,key:u.key,idx:a},F(u)]}function N(u,a,o){return!R.length||(R.call({action:u,location:a,retry:o}),!1)}function C(u){v=u;var a=i();g=a[0],P=a[1],L.call({action:v,location:P})}function $(u,a){var o=y.Push,f=j(u,a);function p(){$(u,a)}if(N(o,f,p)){var b=I(f,g+1),T=b[0],S=b[1];try{s.pushState(T,"",S)}catch{r.location.assign(S)}C(o)}}function O(u,a){var o=y.Replace,f=j(u,a);function p(){O(u,a)}if(N(o,f,p)){var b=I(f,g),T=b[0],S=b[1];s.replaceState(T,"",S),C(o)}}function M(u){s.go(u)}var H={get action(){return v},get location(){return P},createHref:F,push:$,replace:O,go:M,back:function(){M(-1)},forward:function(){M(1)},listen:function(a){return L.push(a)},block:function(a){var o=R.push(a);return R.length===1&&r.addEventListener(D,W),function(){o(),R.length||r.removeEventListener(D,W)}}};return H}function ve(t){t===void 0&&(t={});var e=t,n=e.window,r=n===void 0?document.defaultView:n,s=r.history;function i(){var a=B(r.location.hash.substr(1)),o=a.pathname,f=o===void 0?"/":o,p=a.search,b=p===void 0?"":p,T=a.hash,S=T===void 0?"":T,x=s.state||{};return[x.idx,U({pathname:f,search:b,hash:S,state:x.usr||null,key:x.key||"default"})]}var h=null;function k(){if(h)R.call(h),h=null;else{var a=y.Pop,o=i(),f=o[0],p=o[1];if(R.length){if(f!=null){var b=g-f;b&&(h={action:a,location:p,retry:function(){H(b*-1)}},H(b))}}else $(a)}}r.addEventListener(Q,k),r.addEventListener(de,function(){var a=i(),o=a[1];K(o)!==K(P)&&k()});var v=y.Pop,w=i(),g=w[0],P=w[1],L=z(),R=z();g==null&&(g=0,s.replaceState(d({},s.state,{idx:g}),""));function F(){var a=document.querySelector("base"),o="";if(a&&a.getAttribute("href")){var f=r.location.href,p=f.indexOf("#");o=p===-1?f:f.slice(0,p)}return o}function j(a){return F()+"#"+(typeof a=="string"?a:K(a))}function I(a,o){return o===void 0&&(o=null),U(d({pathname:P.pathname,hash:"",search:""},typeof a=="string"?B(a):a,{state:o,key:Z()}))}function N(a,o){return[{usr:a.state,key:a.key,idx:o},j(a)]}function C(a,o,f){return!R.length||(R.call({action:a,location:o,retry:f}),!1)}function $(a){v=a;var o=i();g=o[0],P=o[1],L.call({action:v,location:P})}function O(a,o){var f=y.Push,p=I(a,o);function b(){O(a,o)}if(C(f,p,b)){var T=N(p,g+1),S=T[0],x=T[1];try{s.pushState(S,"",x)}catch{r.location.assign(x)}$(f)}}function M(a,o){var f=y.Replace,p=I(a,o);function b(){M(a,o)}if(C(f,p,b)){var T=N(p,g),S=T[0],x=T[1];s.replaceState(S,"",x),$(f)}}function H(a){s.go(a)}var u={get action(){return v},get location(){return P},createHref:j,push:O,replace:M,go:H,back:function(){H(-1)},forward:function(){H(1)},listen:function(o){return L.push(o)},block:function(o){var f=R.push(o);return R.length===1&&r.addEventListener(D,W),function(){f(),R.length||r.removeEventListener(D,W)}}};return u}function W(t){t.preventDefault(),t.returnValue=""}function z(){var t=[];return{get length(){return t.length},push:function(n){return t.push(n),function(){t=t.filter(function(r){return r!==n})}},call:function(n){t.forEach(function(r){return r&&r(n)})}}}function Z(){return Math.random().toString(36).substr(2,8)}function K(t){var e=t.pathname,n=e===void 0?"/":e,r=t.search,s=r===void 0?"":r,i=t.hash,h=i===void 0?"":i;return s&&s!=="?"&&(n+=s.charAt(0)==="?"?s:"?"+s),h&&h!=="#"&&(n+=h.charAt(0)==="#"?h:"#"+h),n}function B(t){var e={};if(t){var n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));var r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}const ee=c.createContext({}),ye=t=>React.createElement(ee.Provider,m({},t)),te=c.createContext({}),me=t=>React.createElement(te.Provider,m({},t)),be=t=>{var e;return!!((e=Object.getPrototypeOf(t))!=null&&e.isReactComponent)},we=/import\s?\(/,Re=t=>{if(be(t))return!1;const e=String(t).trim();return e.startsWith("(")&&e.includes("=>")&&we.test(e)},ke=async t=>{const e=await t();return e&&Pe(e)?e.default:e},Pe=t=>t.__esModule||Te&&t[Symbol.toStringTag]==="Module",Te=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",ne="_pageKey";let re=36,ae="";for(;re--;)ae+=re.toString(36);function Ee(t){let e="",n=t||11;for(;n--;)e+=ae[Math.random()*36|0];return e}const Se=(t,e)=>e.toLowerCase().startsWith(t.toLowerCase()),xe=(t,e)=>t==="/"?e:Se(t,e)?e.slice(t.length)||"/":null,Le=(...t)=>t.join("/").replace(/\/\/+/g,"/"),Me=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),se=t=>{const e={};if(!t)return e;const{search:n}=B(t),r=new URLSearchParams(n);for(const[s,i]of r.entries())e[s]=i;return e},He=t=>{const e=new URLSearchParams;for(const[n,r]of Object.entries(t))e.append(n,r);return e.toString()},_e=({search:t})=>{if(!t)return;const n=se(t)[ne];return typeof n=="string"?n:void 0},oe=t=>{const e=se(t.search),n=He(_(m({},e),{[ne]:Ee()}));return _(m({},t),{search:n})};function ie(t,e,n){if(e){typeof console!="undefined"&&console[t](n);try{throw new Error(n)}catch{}}}function Ce(t,e){ie("warn",t,e)}function $e(t,e){ie("error",t,e)}const V=t=>t.type==="tab",Ke=t=>t.type===void 0||t.type==="page",q=(t,e)=>t.name===e.name||t.path===e.path,X=(t,e)=>{let n;return e&&(n=t.find(({name:r,path:s})=>r===e||s===e)),Ce(!n,`Can not find the route when name or path is  \`${e}\` `),n};class Be{constructor({basename:e,history:n,routes:r,stack:s}){E(this,"basename");E(this,"history");E(this,"routes");E(this,"stack");E(this,"routeRecordMap");E(this,"blockerMap");E(this,"listeners",[]);E(this,"unlisteners",[]);this.basename=Me(e),this.routes=r,this.stack=s,this.history=n,this.routeRecordMap=new Map,this.blockerMap=new Map,this.initSubscriber(),this.initWatcher(),this.loadIndexPage()}get location(){return this.history.location}get currentRoute(){return this.stack.current}get stackSnapshoot(){return this.stack.items.slice()}get indexRoute(){return this.routes.find(e=>e.index)||this.routes[0]}async resolveRouteRecord(e){const n=X(this.routes,e);if(!n)return;const{path:r,component:s}=n;if(this.routeRecordMap.has(r))return this.routeRecordMap.get(r);let i;if(Re(s)){const h=await ke(s);if(!h)throw new Error(`Couldn't resolve component  at "${r}"`);i=_(m({},n),{component:h})}else i=_(m({},n),{component:s});return this.routeRecordMap.set(r,i),i}initSubscriber(){const e=this.history.listen(async n=>{const{location:{pathname:r,state:s}}=n,i=xe(this.basename,r);if(!i)return;const h=await this.resolveRouteRecord(i);if(!h)return;const k=_(m({},n),{route:h});if(s){const{blockerId:v}=s,w=this.blockerMap.get(v);if(w&&w(k)===!1){this.blockerMap.delete(v);return}}this.listeners.forEach(v=>{v(k)})});this.unlisteners.push(e)}initWatcher(){this.listen(({route:e,location:n})=>{const r=K(n),s=_e(n);if(s){const i=m({pageKey:s,url:r},e);V(e)?this.stack.switchTab(i):this.stack.jumpPage(i)}else this.history.replace(oe(n))})}loadIndexPage(){this.replace(this.indexRoute.path)}listen(e){this.listeners.push(e);const n=this.listeners.length-1;return()=>{this.listeners.splice(n,1)}}resolveTo(e){let n;if(typeof e=="string")n=B(e);else if("pathname"in e)n=e;else if("name"in e){const r=X(this.routes,e.name);n=r?{pathname:r.path}:void 0}return n!=null&&n.pathname&&(n.pathname=Le(this.basename,n.pathname),n=oe(n)),n}push(e,n){const r=this.resolveTo(e);if(r){let s;if(n){const i=Date.now();s={blockerId:i},this.blockerMap.set(i,n)}this.history.push(r,s)}}replace(e){const n=this.resolveTo(e);n&&(this.stack.pop(),this.history.replace(n))}reset(){this.stack.clear()}back(e=1){const n=this.stack.getLastItem(e);this.history.replace(n.url)}createHref(e){const n=this.resolveTo(e);if(n)return this.history.createHref(n)}destroy(){this.unlisteners.forEach(e=>e())}}let Y;const Ae=(t,e)=>{Y&&clearTimeout(Y),Y=setTimeout(t,e)},ce=t=>{const e=[];return new Proxy(e,{get(n,r){return n[r]},set(n,r,s){return n[r]=s,Ae(t,50),!0}})};class je{constructor(e){E(this,"tabs");E(this,"pages");this.tabs=ce(e),this.pages=ce(e)}get current(){return this.items[this.items.length-1]}get items(){return[...this.tabs,...this.pages]}containsTab(e){return this.tabs.some(n=>q(n,e))}findPageIndex(e){return e.pageKey?this.pages.findIndex(n=>n.pageKey===e.pageKey):-1}getLastItem(e){return this.items[this.items.length-e-1]}switchTab(e){this.containsTab(e)?this.tabs.sort(n=>q(n,e)?-1:0):this.tabs.push(m({},e)),this.clear()}jumpPage(e){const n=this.findPageIndex(e);n>-1?this.pages.splice(n+1,this.pages.length-n-1):this.pages.push(m({},e))}pop(){this.pages.pop()}clear(){this.pages.splice(0,this.pages.length)}}const Ie=()=>{const[,t]=c.useState({});return c.useCallback(()=>t({}),[])},Ne=()=>{const t=Ie();return c.useMemo(()=>new je(t),[])},Oe=t=>{c.useEffect(()=>t,[])},Ue=({basename:t,history:e,routes:n})=>{const r=Ne(),s=c.useRef();s.current||(s.current=new Be({basename:t,history:e,routes:n,stack:r}));const i=s.current,[h,k]=c.useState(e.location);return c.useEffect(()=>{i.listen(function({location:w}){k(w)})},[i]),Oe(()=>{i.destroy()}),{location:h,history:i,matches:r.items}},De={display:"none"},We=({status:t,children:e})=>React.createElement("div",{children:e,style:t==="hide"?De:void 0}),ze=t=>t.map(({pageKey:e,component:n},r)=>{const s=r===t.length-1?"show":"hide";return React.createElement(We,{key:e,status:s},React.createElement(n,null))}),ue=({basename:t="/",history:e,routes:n})=>{const{matches:r,location:s,history:i}=Ue({basename:t,history:e,routes:n}),h=ze(r);return React.createElement(me,{value:{navigator:i}},React.createElement(ye,{children:h,value:{location:s}}))},Fe=({basename:t,routes:e})=>{const n=c.useMemo(()=>ge({window}),[]);return React.createElement(ue,{basename:t,history:n,routes:e})},Ge=({basename:t,routes:e})=>{const n=c.useMemo(()=>ve({window}),[]);return React.createElement(ue,{basename:t,history:n,routes:e})},le=()=>c.useContext(te),Ve=t=>!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey),A=async t=>new Promise((e,n)=>{const{navigator:r,type:s}=t,i=r.listen(()=>{e(),i()});try{if(s==="navigateBack"){const{delta:h}=t;r.back(h)}else{const{name:h,url:k}=t,v=h?{name:h}:k;if(!v)return;s==="navigateTo"||s==="switchTab"?r.push(v,({route:w})=>{if(s==="navigateTo"&&V(w))return $e(!0,`Use \`switchTo\` instead of \`navigateTo\` to switch the tabbar page\uFF1A${w.path}`),!1}):s==="redirectTo"?r.replace(v):s==="reLaunch"&&(r.reset(),r.push(v))}}catch(h){n(`${s}:fail ${h.message||h}`)}}),qe=h=>{var k=h,{className:t,style:e,children:n,title:r=n,onClick:s}=k,i=pe(k,["className","style","children","title","onClick"]);const{navigator:v}=le();if(i.type!=="navigateBack"){const{name:g,url:P}=i,L=g?{name:g}:P;L&&v.createHref(L)}const w=g=>{if((s==null?void 0:s(g))===!1){g.preventDefault();return}g.button===0&&!Ve(g)&&(g.preventDefault(),A(m({navigator:v,type:"navigateTo"},i)))};return React.createElement("a",{className:t,style:e,target:"_self",onClick:w},r)},Xe=()=>{const t=c.useRef(),{navigator:e}=le();return t.current||(t.current={navigateTo:n=>A(m({navigator:e,type:"navigateTo"},n)),redirectTo:n=>A(m({navigator:e,type:"redirectTo"},n)),switchTab:n=>A(m({navigator:e,type:"switchTab"},n)),navigateBack:n=>A(m({navigator:e,type:"navigateBack"},n))}),_(m({},t.current),{currentRoute:e.currentRoute,getSnapshoot(){return e.stackSnapshoot}})},Ye=()=>c.useContext(ee);l.BrowserRouter=Fe,l.HashRouter=Ge,l.Navigator=qe,l.isPageRoute=Ke,l.isSameRoute=q,l.isTabRoute=V,l.matchRoute=X,l.useLocation=Ye,l.useRouter=Xe,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=react-mobile-router.umd.js.map
